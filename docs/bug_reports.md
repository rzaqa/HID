# üêû Bug Reports

| Field | Description                                                                                                                                                                                                                                                          |
|-------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Unique ID** | id_hash_001                                                                                                                                                                                                                                                          |
| **Short name** | HashReadNextLogLine returns code 1 instead of code 4                                                                                                                                                                                                                 |
| **Description of the bug** | The function `HashReadNextLogLine()` from the native `hash.h` library should return `HASH_ERROR_LOG_EMPTY (4)` when the log is exhausted. However, it sometimes returns `HASH_ERROR_GENERAL (1)` instead, which is not documented behavior and breaks integration.   |
| **Steps to reproduce** | 1. Initialize the library via `HashInit()`<br>2. Call `HashDirectory()` on a directory containing several files<br>3. Wait for hashing to complete<br>4. Repeatedly call `HashReadNextLogLine()`<br>5. Observe that after reading all lines, one call returns code 1 |
| **Actual result** | `HashReadNextLogLine()` returns `HASH_ERROR_GENERAL (1)` instead of `HASH_ERROR_LOG_EMPTY (4)` after the log is read completely                                                                                                                                      |
| **Expected result** | `HashReadNextLogLine()` should return `HASH_ERROR_LOG_EMPTY (4)` when the log is empty.                                                                                                                                                                              |


| Field | Description                                                                                                                                                                                                                                                                                                   |
|-------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Unique ID** | id_hash_002                                                                                                                                                                                                                                                                                                   |
| **Short name** | HashStatus silently ignores invalid op_id                                                                                                                                                                                                                                                                     |
| **Description of the bug** | According to `hash.h`, the function `HashStatus(size_t id, bool* running)` should return `HASH_ERROR_ARGUMENT_INVALID` when an invalid or unknown operation ID is passed. However, it currently returns `HASH_ERROR_OK` and sets `running = false`, which may be misleading and contradicts the documentation. |
| **Steps to reproduce** | 1. Initialize the library with `HashInit()`<br>2. Call `HashStatus(999999, &running)` with an unused op_id<br>3. Check the return code                                                                                                                                                                        |
| **Actual result** | Returns `HASH_ERROR_OK` and sets `running = false`                                                                                                                                                                                                                                                            |
| **Expected result** | Should return `HASH_ERROR_ARGUMENT_INVALID` as per documentation in `hash.h`                                                                                                                                                                                                                                  |

| Field | Description                                                                                                                                                                                                                                |
|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Unique ID** | id_hash_003                                                                                                                                                                                                                                |
| **Short name** | HashStop has no effect on active operation                                                                                                                                                                                                 |
| **Description of the bug** | The function `HashStop(size_t id)` is expected to stop a hashing operation running in the background. However, calling this function does not stop the operation ‚Äî the operation continues to run and `HashStatus` keeps returning `True`. |
| **Steps to reproduce** | 1. Initialize the library via `HashInit()`<br>2. Start hashing a directory via `HashDirectory(...)`<br>3. Immediately call `HashStop(op_id)`<br>4. Wait and check `HashStatus(op_id)`<br>5. Operation continues running                    |
| **Actual result** | `HashStop` returns `HASH_ERROR_OK`, but operation is not stopped                                                                                                                                                                           |
| **Expected result** | Hashing operation should terminate shortly after `HashStop(...)` is called                                                                                                                                                                 |

| **Field**              | **Description**                                                                                                                                                                                                                                                                         |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Unique ID**          | id_hash_004                                                                                                                                                                                                                                                                             |
| **Short name**         | Duplicate log lines from `read_log_line()`                                                                                                                                                                                                                                              |
| **Description of the bug** | The function `read_log_line()` returns multiple log lines for the same file during a single hashing operation. This leads to inflated results and incorrect assumptions about hashing progress.                                                                  |
| **Steps to reproduce** | 1. Initialize the library via `HashInit()`<br>2. Start hashing a directory with two files (`a.txt`, `b.txt`) using `start_hashing(...)`<br>3. Wait until the operation completes (`_wait_done(...)`)<br>4. Call `read_log_line()` repeatedly until it returns `None` or raises an error<br>5. Count how many times each file path appears |
| **Actual result**      | File paths appear multiple times in the log: e.g. 3√ó `a.txt`, 4√ó `b.txt`. Total 7 log lines, instead of 2                                                                                                                                                                               |
| **Expected result**    | Each file should be logged exactly once, meaning the number of log lines should match the number of files hashed                                                                                                                                                                       |

| **Field**              | **Description**                                                                                                                                                                                                                              |
|------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Unique ID**          | id_hash_005                                                                                                                                                                                                                                  |
| **Short name**         | HashDirectory crashes when path is invalid                                                                                                                                                                                                  |
| **Description of the bug** | The function `HashDirectory(...)` causes a fatal crash (abort signal) if the given directory path does not exist. This happens because the native C++ code throws an unhandled `std::filesystem_error`.                                   |
| **Steps to reproduce** | 1. Initialize the library via `HashInit()`<br>2. Call `start_hashing("/non/existing/path")`<br>3. Observe crash of the Python process                                                                                                         |
| **Actual result**      | Python process crashes with fatal error due to unhandled exception in native C++ code: `filesystem_error: directory iterator cannot open directory`                                                                                         |
| **Expected result**    | The function should return a safe error code (e.g., `HASH_ERROR_ARGUMENT_INVALID`) without crashing. Python should raise a `RuntimeError`, and the process should continue normally                                                        |